from database import create_tables, get_all_experiments, insert_experiment
from utils import setup_logging


def full_test():
    """–ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç –≤—Å–µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"""
    print("üöÄ –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...")

    # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
    logger = setup_logging()

    try:
        # 1. –¢–µ—Å—Ç–∏—Ä—É–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
        print("\n1. –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL...")
        create_tables()
        experiments = get_all_experiments()
        print(f"   ‚úÖ –í –±–∞–∑–µ {len(experiments)} —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤")

        # 2. –¢–µ—Å—Ç–∏—Ä—É–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞
        print("\n2. –¢–µ—Å—Ç–∏—Ä—É–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞...")
        new_id = insert_experiment(
            name="–ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞",
            is_active=True,
            user_count=150,
            success_rate=0.88,
            impressions=12000,
            clicks=1056
        )
        print(f"   ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç —Å ID: {new_id}")

        # 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –¥–æ–±–∞–≤–∏–ª–∏—Å—å
        experiments = get_all_experiments()
        print(f"   ‚úÖ –¢–µ–ø–µ—Ä—å –≤ –±–∞–∑–µ {len(experiments)} —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤")

        # 4. –í—ã–≤–æ–¥–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞—Ö
        print("\n3. –°–ø–∏—Å–æ–∫ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤:")
        for exp in experiments:
            print(f"   - {exp['name']} (–ê–∫—Ç–∏–≤–Ω—ã–π: {exp['is_active']}, –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {exp['user_count']})")

        print("\nüéâ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ! –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ.")
        return True

    except Exception as e:
        print(f"\n‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: {e}")
        return False


if __name__ == "__main__":
    full_test()